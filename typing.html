<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>タイピング練習</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #news-text { border: 1px solid #ccc; padding: 15px; min-height: 150px; white-space: pre-wrap; margin-bottom: 10px; background-color: #f9f9f9; }
        #typing-area { width: 100%; height: 150px; padding: 15px; box-sizing: border-box; font-size: 16px; resize: none; }
        #timer, #result { font-size: 24px; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>
    <a href="index.html">← メニューに戻る</a>
    <h1>タイピング練習（ニュース）</h1>
    
    <p>ニュース記事を読み込み中...</p>
    <div id="news-text"></div>
    
    <textarea id="typing-area" placeholder="ここにニュース記事をタイピングしてください..." oninput="checkTyping()" disabled></textarea>

    <div id="timer">残り時間: 60秒</div>
    <div id="result"></div>

    <script>
        const newsTextElement = document.getElementById('news-text');
        const typingArea = document.getElementById('typing-area');
        const timerElement = document.getElementById('timer');
        const resultElement = document.getElementById('result');
        let articleContent = "";
        let timerInterval;
        let timeLeft = 60;

        async function fetchNewsTextFile() {
            // APIではなく、リポジトリ内のテキストファイルを読み込む
            const response = await fetch('news_data.txt');
            if (response.ok) {
                articleContent = await response.text();
                if (articleContent.trim().length > 0) {
                    newsTextElement.innerText = articleContent;
                    typingArea.disabled = false;
                    typingArea.focus();
                    startTimer();
                    document.querySelector('p').innerText = "練習開始！"; 
                } else {
                    newsTextElement.innerText = "記事の内容が空です。次の更新を待ってください。";
                }
            } else {
                newsTextElement.innerText = "ニュース記事を読み込めませんでした。Actionsがまだ実行されていないか確認してください。";
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.innerText = `残り時間: ${timeLeft}秒`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function checkTyping() {
            if (typingArea.value === articleContent) {
                clearInterval(timerInterval);
                endGame();
            }
        }

        function endGame() {
            typingArea.disabled = true;
            timerElement.innerText = "終了！";
            const typedChars = typingArea.value.length;
            const wpm = (typedChars / 60) * (60 - timeLeft);
            resultElement.innerText = `スコア: ${typedChars}文字 | 速度: 約${wpm.toFixed(0)}文字/分`;
        }

        fetchNewsTextFile();
    </script>
</body>
</html>
